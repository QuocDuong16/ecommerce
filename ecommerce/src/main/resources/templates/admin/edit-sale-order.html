<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

		<!-- Meta -->
		<meta name="description" content="Moonlight - Responsive Bootstrap 5 Dashboard Template">
		<meta name="author" content="Bootstrap Gallery" />
		<link rel="canonical" href="https://www.bootstrap.gallery/">
		<meta property="og:url" content="https://www.bootstrap.gallery">
		<meta property="og:title" content="Admin Templates - Dashboard Templates | Bootstrap Gallery">
		<meta property="og:description" content="Marketplace for Bootstrap Admin Dashboards">
		<meta property="og:type" content="Website">
		<meta property="og:site_name" content="Bootstrap Gallery">
		<link rel="shortcut icon" th:href="@{/assets/images/favicon.svg}">

		<!-- Title -->
		<title>Modern Admin Dashboards</title>


		<!-- *************
			************ Common Css Files *************
		************ -->

		<!-- Animated css -->
		<link rel="stylesheet" th:href="@{/assets/css/animate.css}">

		<!-- Bootstrap font icons css -->
		<link rel="stylesheet" th:href="@{/assets/fonts/bootstrap/bootstrap-icons.css}">

		<!-- Main css -->
		<link rel="stylesheet" th:href="@{/assets/css/main.min.css}">


		<!-- *************
			************ Vendor Css Files *************
		************ -->

		<!-- Scrollbar CSS -->
		<link rel="stylesheet" th:href="@{/assets/vendor/overlay-scroll/OverlayScrollbars.min.css}">

		<!-- Date Range CSS -->
		<link rel="stylesheet" th:href="@{/assets/vendor/daterange/daterange.css}">

	</head>

	<body>

		<!-- Page wrapper start -->
		<div class="page-wrapper">

			<!-- Sidebar wrapper start -->
			<nav class="sidebar-wrapper">

				<!-- Sidebar brand starts -->
				<div class="sidebar-brand">
					<a th:href="@{/admin/}" class="logo">
						<img th:src="@{/assets/images/logo.svg}" alt="Moonlight Admin Dashboard" />
					</a>
				</div>
				<!-- Sidebar brand starts -->
	
				<!-- Sidebar menu starts -->
				<div class="sidebar-menu">
					<div class="sidebarMenuScroll">
						<ul>
							<li>
								<a th:href="@{/admin/}">
									<i class="bi bi-house"></i>
									Dashboards
								</a>
							</li>
							<li class="sidebar-dropdown">
								<a href="#">
									<i class="bi bi-handbag"></i>
									<span class="menu-text">Product</span>
								</a>
								<div class="sidebar-submenu">
									<ul>
										<li>
											<a th:href="@{/admin/add-product}" >Add Product</a>
										</li>
									</ul>
								</div>
							</li>
							<li class="sidebar-dropdown">
								<a href="#">
									<i class="bi bi-card-list"></i>
									<span class="menu-text">Category</span>
								</a>
								<div class="sidebar-submenu">
									<ul>
										<li>
											<a th:href="@{/admin/add-category}" >Add Category</a>
										</li>
									</ul>
								</div>
							</li>
							<li class="sidebar-dropdown">
								<a href="#">
									<i class="bi bi-building"></i>
									<span class="menu-text">Supplier</span>
								</a>
								<div class="sidebar-submenu">
									<ul>
										<li>
											<a th:href="@{/admin/add-supplier}">Add Supplier</a>
										</li>
									</ul>
								</div>
							</li>
							<li class="sidebar-dropdown">
								<a href="#">
									<i class="bi bi-journals"></i>
									<span class="menu-text">Purchase Orders</span>
								</a>
								<div class="sidebar-submenu">
									<ul>
										<li>
											<a th:href="@{/admin/add-purchase-order}">Add Purchase Order</a>
										</li>
									</ul>
								</div>
							</li>
							<li class="sidebar-dropdown active">
								<a href="#">
									<i class="bi bi-window-split"></i>
									<span class="menu-text">Tables</span>
								</a>
								<div class="sidebar-submenu">
									<ul>
										<li>
											<a th:href="@{/admin/data-orders}" class="current-page">Data Orders</a>
										</li>
										<li>
											<a th:href="@{/admin/data-suppliers}">Data Suppliers</a>
										</li>
										<li>
											<a th:href="@{/admin/data-categories}">Data Categories</a>
										</li>
										<li>
											<a th:href="@{/admin/data-accounts}">Data Accounts</a>
										</li>
										<li>
											<a th:href="@{/admin/data-products}">Data Products</a>
										</li>
									</ul>
								</div>
							</li>
							<li class="sidebar-dropdown">
								<a href="#">
									<i class="bi bi-x-diamond"></i>
									<span class="menu-text">Authentication</span>
								</a>
								<div class="sidebar-submenu">
									<ul>
										<li>
											<a th:href="@{/admin/login}">Login</a>
										</li>
										<li>
											<a th:href="@{/admin/signup}">Signup</a>
										</li>
										<li>
											<a th:href="@{/admin/error}">Error</a>
										</li>
										<li>
											<a th:href="@{/admin/maintenance}">Maintenance</a>
										</li>
									</ul>
								</div>
							</li>
						</ul>
					</div>
				</div>
				<!-- Sidebar menu ends -->
	
			</nav>
			<!-- Sidebar wrapper end -->

			<!-- *************
				************ Main container start *************
			************* -->
			<div class="main-container">

				<!-- Page header starts -->
				<div class="page-header">

					<div class="toggle-sidebar" id="toggle-sidebar"><i class="bi bi-list"></i></div>
	
					<!-- Breadcrumb start -->
					<ol class="breadcrumb">
						<li class="breadcrumb-item">
							<i class="bi bi-house"></i>
							<a th:href="@{/admin/}">Home</a>
						</li>
						<li class="breadcrumb-item">Tables</li>
						<li class="breadcrumb-item breadcrumb-active" aria-current="page">Data Orders</li>
					</ol>
					<!-- Breadcrumb end -->
	
					<!-- Header actions ccontainer start -->
					<div class="header-actions-container">
	
						<!-- Header actions start -->
						<ul class="header-actions">
							<li class="d-none d-md-block">
								<a href="#" id="countries">
									<img th:src="@{/assets/images/flags/1x1/vn.svg}" class="flag-img"
										alt="AI Admin Dashboards" />
								</a>
							</li>
							<li class="dropdown">
								<a href="#" id="userSettings" class="user-settings" data-toggle="dropdown"
									aria-haspopup="true">
									<span class="user-name d-none d-md-block">Abigale Heaney</span>
									<span class="avatar">
										<img th:src="@{/assets/images/user3.png}" alt="Admin Templates">
										<span class="status online"></span>
									</span>
								</a>
								<div class="dropdown-menu dropdown-menu-end" aria-labelledby="userSettings">
									<div class="header-profile-actions">
										<a th:href="@{/admin/login}">Logout</a>
									</div>
								</div>
							</li>
						</ul>
						<!-- Header actions end -->
	
					</div>
					<!-- Header actions ccontainer end -->
	
				</div>
				<!-- Page header ends -->

				<!-- Content wrapper scroll start -->
				<div class="content-wrapper-scroll">

					<!-- Content wrapper start -->
					<div class="content-wrapper">

						<!-- Row start -->
						<div class="row">
							<div class="col-sm-12 col-12">
								<form th:action="@{/admin/edit-sale-order}" method="post" id="saleOrderForm">
									<div class="card">
										<div class="card-header">
											<div class="card-title">Create Sale Order</div>
										</div>
										<div class="card-body">
	
											<div class="create-invoice-wrapper">
	
												<!-- Row start -->
												<div class="row">
													<div class="col-xxl-4 col-lg-5 col-sm-6 col-12">
	
														<!-- Row start -->
														<div class="row">
															<div class="col-sm-12 col-12">
																<input type="text" name="orderId" hidden th:value="${order.orderId}">
																<!-- Form group start -->
																<div class="mb-3">
																	<label class="form-label">Customer <span class="text-red">*</span></label>
																	<select name="customerId" class="form-control">
																		<option 
																			th:each="customer : ${customers}" 
																			th:value="${customer.accountId}" 
																			th:text="${customer.fullName}" 
																			th:selected="${customer.accountId == order.customer.accountId}"></option>
																	</select>
																</div>
																<!-- Form group end -->
	
															</div>
															<div class="col-sm-6 col-12">
	
																<!-- Form group start -->
																<div class="mb-3">
																	<label for="invNumber" class="form-label">Order Type</label>
																	<input type="text" class="form-control" value="Sale" readonly>
																</div>
																<!-- Form group end -->
	
															</div>
															<div class="col-sm-6 col-12">
	
																<!-- Form group start -->
																<div class="mb-3">
																	<label for="dueDate" class="form-label">Due Date</label>
																	<div class="input-group ">
																		<span hidden id="date" th:text="${formattedDate}"></span>
																		<input name="orderDateCreate" type="text" class="form-control datepicker-opens-left" id="dueDate"
																			placeholder="yyyy-MM-dd HH:mm:ss.SSSSSS">
																		<span class="input-group-text"> <i class="bi bi-calendar4"></i> </span>
																		<script>
																			document.getElementById('dueData').value = document.getElementById('date').textContent
																		</script>
																	</div>
																</div>
																<!-- Form group end -->
	
															</div>
														</div>
														<!-- Row end -->
	
													</div>
												</div>
												<!-- Row end -->
	
											</div>
	
											<!-- Row start -->
											<div class="row">
												<div class="col-12">
													<div class="table-responsive">
														<table class="table table-bordered invoice-table">
															<thead>
																<tr>
																	<th colspan="3" class="pt-3 pb-3">Items/Products</th>
																</tr>
																<tr>
																	<th>Product Name</th>
																	<th>Quantity</th>
																	<th>Price</th>
																</tr>
															</thead>
															<tbody>
																<tr th:each="orderDetail: ${orderDetails}" name="orderDetailRow">
																	<td>
																		<!-- Form group start -->
																		<select name="productId" th:value="${orderDetail.product.productId}" class="form-select product" disabled>
																			<option th:each="product : ${products}"
																				th:selected="${product.productId == orderDetail.product.productId}" th:value="${product.productId}" th:text="${product.productName}"></option>
																		</select>
																		<span hidden th:text="${orderDetail.product.productPrice}"></span>
																		<!-- Form group end -->
																	</td>
																	<td>
																		<!-- Form group start -->
																		<div class="m-0">
																			<input name="quantity" type="number" inputmode="numeric" min="1" th:value="${orderDetail.quantity}" class="form-control quantity-input" placeholder="Qty">
																		</div>
																		<!-- Form group end -->
																	</td>
																	<td>
																		<!-- Form group start -->
																		<div class="input-group m-0">
																			<input type="number" min="0" th:value="${orderDetail.getTotalPrice()}" class="form-control total-price-input" readonly>
																			<span class="input-group-text">VND</span>
																		</div>
																		<!-- Form group end -->
																	</td>
																</tr>
																<tr>
																	<td>
																		<button class="btn btn-dark" disabled>Add New Row</button>
																	</td>
																	<td colspan="2">
																		<div class="row justify-content-end">
																			<div class="col-auto">
																				<label class="col-form-label">Discount % of Total Amount</label>
																			</div>
																			<div class="col-auto">
																				<input type="text" class="form-control" placeholder="0%" readonly>
																			</div>
																		</div>
																	</td>
																</tr>
																<tr>
																	<td colspan="1">&nbsp;</td>
																	<td>
																		<p class="m-0">Subtotal</p>
																		<p class="m-0">Discount</p>
																		<h5 class="mt-2 text-red">Total VND</h5>
																	</td>
																	<td>
																		<p class="m-0"><span id="subtotal" th:text="${totalPrice}"></span> VND</p>
																		<p class="m-0">0.00 VND</p>
																		<h5 class="mt-2 text-red"><span id="total" th:text="${totalPrice}"></span> VND</h5>
																	</td>
																</tr>
															</tbody>
														</table>																										
													</div>
												</div>
												<div class="col-12">
													<div class="invoice-footer">
														<div class="text-end">
															<button type="submit" class="btn btn-success">Save Sale Order</button>
														</div>
													</div>
												</div>
											</div>
											<!-- Row end -->
	
										</div>
									</div>
								</form>
							</div>
						</div>
						<!-- Row end -->

					</div>
					<!-- Content wrapper end -->

					<!-- App Footer start -->
					<div class="app-footer">
						<span>© Bootstrap Gallery 2023</span>
					</div>
					<!-- App footer end -->

				</div>
				<!-- Content wrapper scroll end -->

			</div>
			<!-- *************
				************ Main container end *************
			************* -->

		</div>
		<!-- Page wrapper end -->

		<!-- *************
			************ Required JavaScript Files *************
		************* -->
		<!-- Required jQuery first, then Bootstrap Bundle JS -->
		<script th:src="@{/assets/js/jquery.min.js}"></script>
		<script th:src="@{/assets/js/bootstrap.bundle.min.js}"></script>
		<script th:src="@{/assets/js/modernizr.js}"></script>
		<script th:src="@{/assets/js/moment.js}"></script>

		<!-- *************
			************ Vendor Js Files *************
		************* -->

		<!-- Overlay Scroll JS -->
		<script th:src="@{/assets/vendor/overlay-scroll/jquery.overlayScrollbars.min.js}"></script>
		<script th:src="@{/assets/vendor/overlay-scroll/custom-scrollbar.js}"></script>

		<!-- Date Range JS -->
		<script th:src="@{/assets/vendor/daterange/daterange.js}"></script>
		<script th:src="@{/assets/vendor/daterange/custom-daterange.js}"></script>

		<!-- Main Js Required -->
		<script th:src="@{/assets/js/main.js}"></script>
		<script>
			$(document).ready(function () {
				$('.quantity-input').on('change', function () {
					var quantity = $(this).val();
					var productPrice = $(this).closest('tr').find('.product').next('span').text();
		
					var totalPrice = parseFloat(quantity) * parseFloat(productPrice);
					$(this).closest('tr').find('.total-price-input').val(totalPrice.toFixed(2));
		
					updateTotal();
				});
		
				function updateTotal() {
					var totalPrices = 0;
		
					$('.total-price-input').each(function () {
						totalPrices += parseFloat($(this).val());
					});
		
					$('#subtotal').text(totalPrices.toFixed(2));
					$('#total').text(totalPrices.toFixed(2));
				}
			});
		</script>
		<script th:inline="javascript">
			$(document).ready(function () {
				$("#saleOrderForm").submit(function (event) {
					event.preventDefault();
					var orderId = document.getElementsByName("orderId")[0].value;
					var orderDateCreate = document.getElementsByName("orderDateCreate")[0].value;
					var customerId = document.getElementsByName("customerId")[0].value;
					var orderDetailRows = document.getElementsByName("orderDetailRow");
					var orderDetails = [];
					for (var i = 0; i < orderDetailRows.length; i++) {
						var productId = orderDetailRows[i].getElementsByTagName('select')[0].value;
    					var quantity = orderDetailRows[i].getElementsByTagName('input')[0].value;
						orderDetails.push(
							{
								orderId: orderId,
								productId: productId,
								quantity: quantity
							}
						)
					}
					var formData = $("#saleOrderForm").serialize();
					console.log(formData)
					var data = {
							orderId: orderId,
							orderDateCreate: orderDateCreate,
							customerId: customerId,
							orderDetails: orderDetails
						}
					console.log(data)
					$.ajax({
						type: "POST",
						url: "/admin/edit-sale-order", // Thay thế bằng đường dẫn API thực sự
						contentType: 'application/json',
						data: JSON.stringify(data),
						success: function (response) {
							// Xử lý kết quả thành công
							console.log("Success:", response);
							window.location.href = "/admin/data-orders";
						},
						error: function (error) {
							// Xử lý lỗi
							console.log("Error:", error);
						}
					});
				});
			});

		</script>
	</body>

</html>